<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ book['title'] }} - Details</title>
    <style>
        :root {
            --bg-color: #121212;
            --surface-color: #1e1e1e;
            --text-primary: #e0e0e0;
            --text-secondary: #b0b0b0;
            --accent-color: #4e9f3d; 
            --border-color: #333333;
        }
        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            font-family: 'Segoe UI', sans-serif;
            padding: 40px;
            max-width: 900px;
            margin: 0 auto;
        }
        
        /* Navigation Bar */
        .nav-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .nav-link { color: var(--accent-color); text-decoration: none; font-size: 0.9rem; }
        .nav-link:hover { text-decoration: underline; }

        /* Main Container */
        .book-container {
            background-color: var(--surface-color);
            padding: 30px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            display: flex;
            gap: 40px;
            align-items: flex-start;
        }

        /* --- LEFT COLUMN: COVER --- */
        .cover-area { flex: 0 0 200px; }
        .cover-img { width: 100%; border-radius: 4px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); border: 1px solid #333; }

        .placeholder-cover {
            width: 100%; height: 300px;
            background: linear-gradient(135deg, #2c2c2c 0%, #3a3a3a 100%);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            text-align: center; padding: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            color: var(--text-primary);
        }
        .placeholder-title { font-weight: bold; font-size: 1.2rem; margin-bottom: 10px; font-family: serif; }
        .placeholder-author { font-size: 0.95rem; color: var(--text-secondary); }

        /* --- RIGHT COLUMN: INFO --- */
        .info-area { flex: 1; }

        h1 { margin-top: 0; margin-bottom: 5px; color: var(--text-primary); line-height: 1.2; }
        h2 { margin-top: 0; color: var(--text-secondary); font-weight: 400; font-size: 1.3rem; margin-bottom: 15px; }
        
        .series-badge {
            background-color: #1b3320; color: var(--accent-color);
            padding: 6px 10px; border-radius: 4px; border: 1px solid #2e5c35;
            font-size: 0.9rem; display: inline-block; margin-bottom: 15px;
        }

        .badges-row { margin-bottom: 25px; display: flex; gap: 8px; flex-wrap: wrap; }
        .badge {
            padding: 4px 10px; border-radius: 12px; font-size: 0.8rem; font-weight: bold; text-transform: uppercase; letter-spacing: 0.5px;
        }
        .badge-read { background-color: #1b3320; color: #4e9f3d; border: 1px solid #4e9f3d; }
        .badge-tbr { background-color: #333; color: #aaa; border: 1px solid #555; }
        .badge-dnf { background-color: #3e1b1b; color: #cf6679; border: 1px solid #cf6679; }
        .badge-signed { background-color: #3e3200; color: #ffd700; border: 1px solid #ffd700; }

        .details-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 25px; margin-top: 20px; border-top: 1px solid var(--border-color); padding-top: 20px;
        }

        .detail-item strong { display: block; color: var(--text-secondary); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; }
        .detail-item span { display: block; font-size: 1.05rem; }

        .notes-section { margin-top: 35px; background-color: #252525; padding: 20px; border-radius: 4px; border-left: 4px solid var(--accent-color); }
        .notes-label { font-weight: bold; display: block; margin-bottom: 5px; color: var(--text-secondary); font-size: 0.85rem;}

        @media (max-width: 700px) {
            .book-container { flex-direction: column; align-items: center; }
            .cover-area { flex: none; width: 200px; margin-bottom: 20px; }
            .info-area { width: 100%; }
        }
    </style>
</head>
<body>

    <div class="nav-bar">
        <a href="/" class="nav-link">← Back to Library</a>
        
        <!-- Admin Toolbar -->
        {% if not is_read_only %}
            <div style="display: flex; gap: 10px;">
                <a href="/book/{{ book['id'] }}/edit" style="background-color: #333; color: var(--text-primary); text-decoration: none; padding: 6px 12px; border-radius: 4px; font-size: 0.9rem; border: 1px solid var(--border-color);">Edit</a>
                <form action="/book/{{ book['id'] }}/delete" method="POST" onsubmit="return confirm('Are you sure you want to delete this book?');">
                    <button type="submit" style="background-color: #8b0000; color: white; border: none; padding: 7px 12px; border-radius: 4px; cursor: pointer; font-size: 0.9rem;">Delete</button>
                </form>
            </div>
        {% endif %}
    </div>

    <div class="book-container">
        
        <div class="cover-area">
            {% if book['cover_url'] %}
                <img src="{{ book['cover_url'] }}" alt="Cover for {{ book['title'] }}" class="cover-img">
            {% else %}
                <div class="placeholder-cover">
                    <div class="placeholder-title">{{ book['title'] }}</div>
                    <div class="placeholder-author">{{ book['author'] }}</div>
                </div>
            {% endif %}
        </div>

        <div class="info-area">
            <h1>{{ book['title'] }}</h1>
            <h2>{{ book['author'] }}</h2>

            <div class="badges-row">
                <!-- Status Badge Logic -->
                {% if book['read_status'] == 'Read' %}
                    <span class="badge badge-read">Read</span>
                {% elif book['read_status'] == 'DNF' %}
                    <span class="badge badge-dnf">DNF</span>
                {% elif book['read_status'] == 'To Read' %}
                    <span class="badge badge-tbr">To Read</span>
                {% elif book['read_status'] == 'Reference' %}
                     <span class="badge badge-tbr" style="background-color: #222; border-color: #444;">Reference</span>
                {% endif %}
                <!-- Note: If status is None/Empty, NO badge is shown. -->
                <!-- Signed Badge -->
                {% if book['is_signed'] %}
                    <span class="badge badge-signed">★ Signed</span>
                {% endif %}
            </div>

            {% if book['series_title'] %}
            <div class="series-badge">
                {{ book['series_title'] }} 
                {% if book['series_number'] %} #{{ book['series_number'] }}{% endif %}
            </div>
            {% endif %}

            <div class="details-grid">
                <div class="detail-item"><strong>Format</strong> <span>{{ book['binding'] }}</span></div>
                <div class="detail-item"><strong>Pages</strong> <span>{{ book['page_count'] or '-' }}</span></div>
                <div class="detail-item"><strong>Publisher</strong> <span>{{ book['publisher'] }}</span></div>
                <div class="detail-item"><strong>Year</strong> <span>{{ book['published_year'] or '-' }}</span></div>
                
                <div class="detail-item">
                    <strong>Dimensions</strong> 
                    <span>
                        {% if book['height'] %}H: {{ book['height'] }} mm<br>{% endif %}
                        {% if book['width'] %}W: {{ book['width'] }} mm{% endif %}
                    </span>
                </div>
                
                {% if book['weight'] %}
                <div class="detail-item"><strong>Weight</strong> <span>{{ book['weight'] }} g</span></div>
                {% endif %}

                <div class="detail-item">
                    <strong>ISBN</strong> 
                    <span>
                        {% if book['isbn'] %}
                            {{ book['isbn'] }}
                        {% elif book['no_isbn'] == 1 %}
                            <span style="color: var(--text-secondary); font-style: italic;">N/A</span>
                        {% else %}
                            -
                        {% endif %}
                    </span>
                </div>
            </div>

            {% if book['notes'] %}
            <div class="notes-section">
                <span class="notes-label">NOTES</span>
                {{ book['notes'] }}
            </div>
            {% endif %}

            {% if siblings %}
            <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--border-color);">
                <h3 style="color: var(--text-primary); font-size: 1rem; margin-bottom: 10px;">
                    Other Copies in Your Library
                </h3>
                <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                    {% for sib in siblings %}
                    <a href="/book/{{ sib['id'] }}" style="text-decoration: none; background-color: #2d2d2d; border: 1px solid #444; padding: 8px 12px; border-radius: 4px; color: var(--text-secondary); font-size: 0.9rem; transition: all 0.2s;">
                        <strong>{{ sib['binding'] }}</strong> {% if sib['published_year'] %}({{ sib['published_year'] }}){% endif %} <span style="color: var(--accent-color);">↗</span>
                    </a>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>

    </div>

</body>
</html>